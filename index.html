<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Prompt Database</title>

<style>
  body{
    margin:0;
    background:#050a1a;
    color:white;
    font-family:system-ui, -apple-system, Segoe UI, Roboto;
  }

  /* HERO VIDEO */
  .hero{
    position:relative;
    width:100%;
    height:300px;
    overflow:hidden;
    border-bottom:1px solid rgba(255,255,255,.15);
  }

  .hero video{
    width:100%;
    height:100%;
    object-fit:cover;
  }

  .overlay{
    position:absolute;
    inset:0;
    display:flex;
    align-items:flex-end;
    padding:18px;
    background:linear-gradient(180deg,rgba(0,0,0,.1),rgba(0,0,0,.85));
  }

  .overlay h1{
    margin:0;
    font-size:26px;
    font-weight:800;
  }

  .container{
    max-width:900px;
    margin:15px auto;
    padding:12px;
  }

  .searchBox{
    width:100%;
    padding:12px;
    border-radius:10px;
    border:0;
    outline:0;
    font-size:15px;
  }

  .tags{
    margin:10px 0;
    display:flex;
    flex-wrap:wrap;
    gap:8px;
  }

  .tag{
    padding:5px 10px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,.2);
    cursor:pointer;
    font-size:13px;
    transition: background 0.2s, color 0.2s;
  }

  .tag:hover {
    background: rgba(255,255,255,0.1);
  }

  .tag.active{
    background:#4a7aff;
    border-color: #4a7aff;
  }

  .prompt{
    background:#0c1430;
    border:1px solid rgba(255,255,255,.15);
    padding:12px;
    margin-bottom:10px;
    border-radius:12px;
  }

  button{
    background:#4a7aff;
    border:0;
    padding:8px 12px;
    border-radius:8px;
    color:white;
    cursor:pointer;
  }
  
  button:hover {
    opacity: 0.9;
  }

  .sample{
    width:100%;
    border-radius:10px;
    margin-top:10px;
    display:none;
  }

</style>
</head>

<body>

<div class="hero">
  <video autoplay loop muted playsinline>
    <source src="/hero.mp4" type="video/mp4"/>
  </video>
  <div class="overlay">
    <h1>Prompt Database</h1>
  </div>
</div>


<div class="container">

  <input id="search" class="searchBox" placeholder="Search prompts..."/>

  <div class="tags" id="tags"></div>

  <h2>Prompts</h2>
  <div id="promptList">Loading...</div>

</div>

<script>
let prompts = [];
let activeTag = null;

// Initialize
loadPrompts();

// Search Listener
document.getElementById("search").addEventListener("input", render);

async function loadPrompts(){
  try {
    const res = await fetch("/api/prompts");
    if (!res.ok) throw new Error("Failed to load API");
    prompts = await res.json();
    buildTags();
    render();
  } catch (e) {
    console.error(e);
    document.getElementById("promptList").innerHTML = 
      "<div style='opacity:0.7'>Error loading prompts.<br>Ensure the backend is running and environment variables are set.</div>";
  }
}

function buildTags(){
  const all = new Set();
  prompts.forEach(p => (p.tags||[]).forEach(t=>all.add(t)));
  
  const tagBox = document.getElementById("tags");
  tagBox.innerHTML = "";
  
  // Sort tags alphabetically
  Array.from(all).sort().forEach(tag => {
    const span = document.createElement("div");
    span.className = "tag";
    if (activeTag === tag) span.classList.add("active");
    span.innerText = tag;
    
    span.onclick = () => {
      // Toggle active tag
      activeTag = (activeTag === tag) ? null : tag;
      buildTags();
      render();
    };
    
    tagBox.appendChild(span);
  });
}

function render() {
  const query = document.getElementById("search").value.toLowerCase();
  const list = document.getElementById("promptList");
  list.innerHTML = "";

  const filtered = prompts.filter(p => {
    // Tag Filter
    if (activeTag && !(p.tags || []).includes(activeTag)) return false;
    
    // Search Filter
    const text = (p.title + " " + p.prompt).toLowerCase();
    return text.includes(query);
  });

  if (filtered.length === 0) {
    list.innerHTML = "<div style='padding:10px; opacity:0.7'>No prompts found.</div>";
    return;
  }

  filtered.forEach(p => {
    const el = document.createElement("div");
    el.className = "prompt";
    
    const tagsHtml = (p.tags || []).map(t => 
      `<span class="tag" style="cursor:default; font-size:11px; padding:3px 8px;">${t}</span>`
    ).join(" ");

    el.innerHTML = `
      <h3 style="margin-top:0; color:#4a7aff">${p.title || "Untitled"}</h3>
      <div style="margin-bottom:15px; opacity:0.9; line-height:1.5; white-space: pre-wrap;">${p.prompt}</div>
      
      <div style="display:flex; align-items:center; justify-content:space-between; margin-top:15px; border-top:1px solid rgba(255,255,255,0.1); padding-top:10px;">
        <div class="tags" style="margin:0; gap:5px;">${tagsHtml}</div>
        <button onclick="copyToClipboard(this)">Copy Prompt</button>
      </div>
    `;
    list.appendChild(el);
  });
}

function copyToClipboard(btn) {
  // Find the prompt text: The sibling before the footer container
  const promptText = btn.parentElement.previousElementSibling.innerText;
  navigator.clipboard.writeText(promptText);
  
  const original = btn.innerText;
  btn.innerText = "Copied!";
  setTimeout(() => btn.innerText = original, 2000);
}
</script>
</body>
</html>